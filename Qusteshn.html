<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>آزمون آنلاین</title>

<style>
body{
  margin:0;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  font-family: Vazirmatn, sans-serif;
}

/* تایمر */
#timer{
  position:fixed;
  top:15px;
  left:15px;
  background:rgba(0,0,0,.6);
  padding:10px 18px;
  border-radius:8px;
  font-weight:bold;
  z-index:1000;
}
#timer.warning{color:#ff4d4d}

/* کارت آزمون */
.card{
  max-width:800px;
  margin:80px auto;
  background:rgba(0,0,0,.45);
  padding:25px;
  border-radius:16px;
  user-select:none;
}

/* گزینه‌ها */
.options label{
  display:flex;
  gap:10px;
  border:1px solid rgba(255,255,255,.3);
  padding:10px;
  border-radius:8px;
  margin-top:10px;
  cursor:pointer;
}
.options label:hover{background:rgba(0,255,153,.15)}

button{
  background:#00ff99;
  border:none;
  padding:10px 20px;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}

/* ناوبری سوالات */
.sidebar{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:15px;
}
.qbtn{
  width:36px;
  height:36px;
  border-radius:50%;
  border:1px solid #00ff99;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.qbtn.answered{background:#00ff99;color:#000}
.qbtn.current{border:2px solid yellow}

/* هشدار پایین */
#warningText{
  position:fixed;
  bottom:10px;
  right:50%;
  transform:translateX(50%);
  font-size:13px;
  color:#ffcc00;
  opacity:.85;
}

/* بازخورد */
#feedback{
  display:none;
  max-width:600px;
  margin:80px auto;
  background:rgba(0,0,0,.5);
  padding:25px;
  border-radius:16px;
  box-shadow:0 0 15px rgba(0,255,153,.4);
}
#feedback h3{
  margin-bottom:15px;
  text-align:center;
  color:#00ff99;
}
#feedback textarea{
  width:100%;
  min-height:120px;
  background:rgba(255,255,255,.05);
  border:none;
  border-radius:12px;
  color:#fff;
  padding:15px;
  font-size:14px;
  resize:none;
}
#feedback button{
  display:block;
  margin:20px auto 0 auto;
  background:#00ff99;
  border:none;
  border-radius:8px;
  padding:12px 25px;
  font-weight:bold;
  cursor:pointer;
}

/* دکمه شروع */
#startBtn{
  display:block;
  margin:150px auto;
  font-size:20px;
  padding:15px 40px;
}

/* اورلی فول‌اسکرین */
#fsOverlay, #violationOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.88);
  z-index:9999;
  color:#fff;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:20px;
  text-align:center;
}
#fsOverlay button, #violationOverlay button{
  font-size:16px;
  padding:12px 30px;
}
#violationOverlay h3{color:#ff4d4d;}
</style>
</head>

<body>

<div id="timer" style="display:none">90:00</div>
<div id="warningText">⚠ تغییر تب یا خروج از تمام‌صفحه به‌عنوان تقلب ثبت می‌شود</div>

<button id="startBtn">شروع آزمون</button>

<div class="card" id="examBox" style="display:none">
  <h3 id="qText"></h3>
  <div class="options" id="options"></div>

  <div style="margin-top:15px;display:flex;justify-content:space-between">
    <button onclick="prevQ()">قبلی</button>
    <button onclick="nextQ()">بعدی</button>
    <button onclick="finishExam(false)">اتمام آزمون</button>
  </div>

  <div class="sidebar" id="nav"></div>
</div>

<div id="feedback">
  <h3>نظر شما درباره سایت</h3>
  <textarea placeholder="نظر خود را بنویسید..."></textarea>
  <button id="submitFeedback">ثبت بازخورد</button>
</div>

<!-- اورلی بازگشت به فول‌اسکرین -->
<div id="fsOverlay">
  <h3>⚠ از محیط آزمون خارج شدید</h3>
  <p>برای ادامه آزمون باید به حالت تمام‌صفحه برگردید</p>
  <button id="fsBackBtn">بازگشت به آزمون</button>
</div>

<!-- اورلی تخلف -->
<div id="violationOverlay">
  <h3>❌ به دلیل تخلف مکرر، آزمون پایان یافت</h3>
</div>

<script>
// ---------- داده‌ها ----------
const questions=[
 {t:"سوال ۱: متن نمونه",o:["گزینه ۱","گزینه ۲","گزینه ۳","گزینه ۴"]},
 {t:"سوال ۲: متن نمونه",o:["گزینه ۱","گزینه ۲","گزینه ۳","گزینه ۴"]},
 {t:"سوال ۳: متن نمونه",o:["گزینه ۱","گزینه ۲","گزینه ۳","گزینه ۴"]},
 {t:"سوال ۴: متن نمونه",o:["گزینه ۱","گزینه ۲","گزینه ۳","گزینه ۴"]}
];

let cur=0;
let answers=Array(questions.length).fill(null);
let time=90*60;
let interval=null;
let examFinished=false;
let violations=0;
const MAX_VIOLATIONS=2;

// ---------- المان‌ها ----------
const qText=document.getElementById("qText");
const options=document.getElementById("options");
const nav=document.getElementById("nav");
const timer=document.getElementById("timer");
const feedback=document.getElementById("feedback");
const fsOverlay=document.getElementById("fsOverlay");
const violationOverlay=document.getElementById("violationOverlay");

// ---------- ناوبری ----------
questions.forEach((_,i)=>{
  const d=document.createElement("div");
  d.className="qbtn";
  d.innerText=i+1;
  d.onclick=()=>{cur=i;render()};
  nav.appendChild(d);
});

// ---------- رندر ----------
function render(){
  qText.innerText=questions[cur].t;
  options.innerHTML="";
  questions[cur].o.forEach((op,i)=>{
    const l=document.createElement("label");
    l.innerHTML=`<input type="radio" name="ans" ${answers[cur]==i?"checked":""}> ${op}`;
    l.onclick=()=>{answers[cur]=i;renderNav()};
    options.appendChild(l);
  });
  renderNav();
}
function renderNav(){
  [...nav.children].forEach((b,i)=>{
    b.className="qbtn";
    if(answers[i]!=null)b.classList.add("answered");
    if(i===cur)b.classList.add("current");
  });
}
function nextQ(){if(cur<questions.length-1){cur++;render()}}
function prevQ(){if(cur>0){cur--;render()}}

// ---------- تایمر ----------
function startTimer(){
  clearInterval(interval);
  timer.style.display="block";
  interval=setInterval(()=>{
    if(time<=0){finishExam(true); return;}
    let m=Math.floor(time/60);
    let s=time%60;
    timer.innerText=`${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    if(time<=300)timer.classList.add("warning");
    time--;
  },1000);
}

// ---------- فول‌اسکرین ----------
function goFullscreen(){document.documentElement.requestFullscreen?.();}

// ---------- تخلف ----------
function registerViolation(){
  if(examFinished) return;
  violations++;
  clearInterval(interval);
  if(violations>=MAX_VIOLATIONS){
    violationOverlay.style.display="flex";
    setTimeout(()=>{finishExam(true)},2000);
    return;
  }
  fsOverlay.style.display="flex";
}

// ---------- لیسنرها ----------
document.addEventListener("visibilitychange",()=>{
  if(document.hidden && !examFinished){
    registerViolation();
  }
});
document.addEventListener("fullscreenchange",()=>{
  if(!document.fullscreenElement && !examFinished){
    registerViolation();
  }
});

// ---------- بازگشت ----------
document.getElementById("fsBackBtn").onclick=()=>{
  fsOverlay.style.display="none";
  goFullscreen();
  startTimer();
};

// ---------- پایان ----------
function finishExam(auto){
  if(examFinished) return;
  examFinished=true;
  clearInterval(interval);
  document.getElementById("examBox").style.display="none";
  document.getElementById("startBtn").style.display="none";
  fsOverlay.style.display="none";
  feedback.style.display="block";
  if(document.fullscreenElement) document.exitFullscreen();
  console.log("پاسخ‌ها:",answers,"پایان خودکار:",auto);
}

// ---------- شروع ----------
document.getElementById("startBtn").onclick=()=>{
  document.getElementById("startBtn").style.display="none";
  document.getElementById("examBox").style.display="block";
  render();
  goFullscreen();
  startTimer();
};

// ---------- بازخورد ----------
document.getElementById("submitFeedback").onclick=()=>{
  const txt=document.querySelector("#feedback textarea").value.trim();
  if(!txt){alert("لطفاً نظر خود را وارد کنید"); return;}
  alert("بازخورد شما ثبت شد ✅");
  examFinished=true;
};

// جلوگیری از کپی
document.addEventListener("copy",e=>e.preventDefault());
document.addEventListener("contextmenu",e=>e.preventDefault());
</script>

</body>
</html>
